---
title: "Google Trend - Video Games"
output: 
  html_notebook: 
    code_folding: hide
---

# Background
Stay-at-home orders for COVID-19 forced people to stay at home. Anecdotal and media reports suggested that people consumed more and more video games during the lockdown. Below, I will use the Google Trend Data for the topic Video Game to see how the interests in video games increased during the lockdown compared with the previous years, and the number of states who declared a stay-at-home order.

# Method


```{r}
# Load Libraries
library(tidyverse)
library(lubridate)
library(gtrendsR)
library(here)
library(plotly)

# API Code from GTrend
filename <- "Google Trend - Gaming.csv"
# Topics:
#   - Video Game (%2Fm%2F01mw1)
#   - Game (%2Fm%2F03bt1gh)

# Get the gtrend data
video_game_topic_id <- "%2Fm%2F01mw1"
video_game_gtrend <- gtrends(keyword = video_game_topic_id,
                             onlyInterest = TRUE, geo = "US")

# Function to get interests df only and return a tibble
get_interests <- function(gtrend_input){
  interests_tibble <- gtrend_input[["interest_over_time"]] %>% 
    as_tibble() %>%
  mutate(Year = year(date),
         Day = day(date),
         Month = month(date),
         `Week Number` = week(date),
         "Date" = as_datetime(paste0("2020-", Month, "-", Day)))
  return(interests_tibble)
}

# Get a tibble from gtrend
video_game_gtrend_interests <- get_interests(video_game_gtrend)

# Save out as a CSV
write_csv(video_game_gtrend_interests, here("data/video_game_gtrend.csv"))

# Load stay-at-home data from Wikipedia
stay_home_dates <- read_csv(here("data/wikipedia.csv"),
                            col_types = list()) # load with auto col types
# Get the df showing how many states are stay-at-home at an given date
stayathome_df <- stay_home_dates %>% 
  select(-Stateofemergencydeclared) %>%
  pivot_longer(c(Stayathomeordered, Datelifted),
               values_to = "Date", names_to = "Event") %>%
  arrange(Date) %>%
  mutate(weight = case_when(Event == "Stayathomeordered" & is.na(Date) == FALSE ~ 1,
                            Event == "Datelifted" & is.na(Date) == FALSE ~ -1)) %>% 
  mutate(n_stayathome = cumsum(weight))

## Combine the stayathome df with the google, fill downward
vg_home_df <- video_game_gtrend_interests %>%
  full_join(stayathome_df, by = "Date") %>% 
  drop_na(Date) %>%
  arrange(Date) %>%
  fill(n_stayathome, .direction = "down")
```



I use data from Google Trend for Goole Trend Scores. I chose the topic Video Game (Topic ID: ``r video_game_topic_id`` to see the overall interests in this topic (rather than using a specific search term). The data included the Google Trend scores from `r video_game_gtrend_interests$date %>% min()` to `r video_game_gtrend_interests$date %>% max()`. I downloaded data using the `gtrendsR::gtrends()` function.

To get the number of states on a stay-at-home order in given dates, I used the table from the Wikipedia entry, ["U.S. state and local government responses to the COVID-19 pandemic"](https://en.wikipedia.org/wiki/U.S._state_and_local_government_responses_to_the_COVID-19_pandemic). The file is available as `wikipedia.csv` in the data folder.


# Results

I created a plot showing Google Trend Scores for Topic:Video Game. The x-axis represents months of a year. The colored lines represents the scores by years. The gray line represents the number of stats on a stay-at-home order on a given date in 2020.

The upward spikes of the Google Trend Scores correspond with the upward spike of the number of stay-at-home order states (Mid-March to April). Both the Google Trend Scores and the number of stay-at-home order states remained high until May. Then, the number of stay-at-home states decreased as some states started to reopen. The interests in video games decreased, but the interests are higher than those in the pre-COVID period. The interests of video games in 2020 were also higher than those of previous years from May until October (the time of the writing now). However, the Google Trend scores in 2020 so far did not exceed with the highest scores observed in November and December in 2015-2020. 

```{r}
# Axis scaling factor for the second (stay-at-home) y-axis
sec_axis_scaling <- 3

# Create a ggplot
vg_home_df %>%
  filter(Year %in% 2016:2020) %>%
  group_by(Year) %>%
  ggplot(aes(x = Date, y = hits, color = factor(Year))) +
  # Line for the gtrend scores
  geom_line(size = 1.5, alpha = .7) + 
  # Line for the stay-at-home order
  geom_line(aes(y = n_stayathome*sec_axis_scaling, color = NULL),
            color = "gray", size = 1.2, alpha = .8) + 
  # Labels
  #   Y-axis
  ylab("Trend Scores for \"Video game\" (US)") +
  #   Second Y-axis
  scale_y_continuous(sec.axis = sec_axis(~./sec_axis_scaling,
                                         name = "Number of Stay-At-Home States")) + 
  #   X-axis
  scale_x_datetime(date_labels = "%b", name = "Month", date_breaks = "1 month") + 
  #   Caption
  labs(caption = "Source: Google Trends (https://trends.google.com/), Wikipedia") +
  #   Legend Title
  scale_color_discrete(name = "Year") + 
  # Theme
  theme_classic(base_size = 12)
```

```{r, fig.width=7, fig.height=5}
vg_home_df2020 <- vg_home_df %>% filter(Year == 2020)
vg_home_df %>%
  filter(Year %in% 2016:2020) %>%
  group_by(Year) %>%
  ggplot(aes(x = Date, y = hits, color = factor(Year))) +
  # Line for the gtrend scores
  geom_line(size = 1.5, alpha = .7) + 
  # Labels
  #   Y-axis
  ylab("Trend Scores") +
  #   X-axis
  scale_x_datetime(date_labels = "%b", name = "Month", date_breaks = "1 month") + 
  #   Caption
  labs(caption = "Source: Google Trends (https://trends.google.com/)") +
  #   Legend Title
  scale_color_manual(name = "Year", values=c(rep("#404040", 4), "#FC8D62")) +
  ggtitle("Google Trend Scores for \"Video Game\" in the US") + 
  # Theme
  theme_classic(base_size = 12)

# get color 
# brewer.pal(n=5,"Set2")

```


# Conclusion
The interests in video games spiked up during the stay-at-home order, compared with the trends in the previous years.


 